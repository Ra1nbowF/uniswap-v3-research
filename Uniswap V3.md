---


---

<h3 id="обзор-uniswap-v3">Обзор Uniswap v3</h3>
<p>Uniswap v3 основные преимущества:</p>
<p><strong>Концентрированная ликвидность,</strong><br>
Одной из ключевых инноваций Uniswap v3 является концентрированная ликвидность. Поставщики ликвидности (LP) могут выбрать определенные ценовые диапазоны, в которых они хотят предоставлять ликвидность, вместо того чтобы распределять ее по всей кривой цен. Это позволяет LP сосредоточить свой капитал там, где они ожидают наибольшую торговую активность, повышая эффективность использования капитала.</p>
<p><strong>Активная ликвидность</strong><br>
LP могут динамически менять свои позиции, добавлять или убирать ликвидность, выбирать различные ценовые диапазоны и уровни комиссий в одном пуле. Это позволяет LP адаптироваться к изменяющимся рыночным условиям и лучше управлять своими рисками.</p>
<p><strong>Несколько уровней комиссий,</strong><br>
Uniswap v3 предлагает три уровня комиссий: 0.05%, 0.30% и 1%. Это дает LP возможность выбирать уровень риска и доходности, подходящий для конкретной пары токенов. Например, более стабильные пары могут выбирать низкие комиссии, а более волатильные — высокие.</p>
<p><strong>Оракулы Uniswap теперь намного проще и дешевле интегрировать</strong>.<br>
Оракулы V3 способны предоставлять средневзвешенные по времени цены (TWAP) по запросу для любого периода за последние ~ 9 дней. Это устраняет необходимость интеграторов сохранять исторические значения.</p>
<p>Даже с этими революционными улучшениями в дизайне  стоимость газа для свопов v3 в основной сети Ethereum немного дешевле, чем v2. Транзакции, совершаемые в Optimism и Arbitrum, значительно  дешевле!</p>
<p><strong>NFT LP токены:</strong><br>
В Uniswap v3 каждая позиция ликвидности представлена в виде NFT. Это позволяет LP более гибко управлять своими позициями, поскольку каждый NFT может представлять уникальный диапазон ликвидности и уровень комиссий.</p>
<h2 id="детальное-описание">Детальное описание</h2>
<h3 id="концентрированная-ликвидность">Концентрированная ликвидность</h3>
<p>В Uniswap v2 ликвидность распределяется равномерно вдоль ценовой кривой x*y=k, с резервами активов для всех цен от 0 до бесконечности. Для большинства пулов большая часть этой ликвидности никогда не используется.</p>
<p>LP-и v2 получают комиссионные только с небольшой части своего капитала, что может не компенсировать соответствующим образом ценовой риск (непостоянные потери), который они принимают на себя, удерживая большие запасы в обоих токенах. Кроме того, трейдеры часто сталкиваются с высоким скольжением, поскольку ликвидность распределяется по всем ценовым диапазонам.</p>
<p>В Uniswap v3 LP-ам можно  <strong>концентрировать свой капитал в пределах заданных ценовых диапазонов, обеспечивая большую ликвидность по желаемым ценам.</strong>  Таким образом,  <strong>LP-и создают индивидуальные ценовые кривые</strong>  , которые отражают их собственные предпочтения.</p>
<p>LP-и могут объединять любое количество отдельных сконцентрированных позиций в одном пуле. Например, LP в пуле ETH/USDTможет решить выделить 1000 долларов в ценовых диапазонах от 1000 до 2000 долларов и дополнительно 1000 долларов в диапазонах от 1500 до 1750 долларов.</p>
<p>Таким образом, LP может приблизить опыт AMM к опыту активного стакана заявок.</p>
<p><strong>Лимитные ордера</strong></p>
<p>Возможность настройки LP в v3 открывает новую функцию ордера, дополняющую рыночные ордера, по сути «лимитные ордера».</p>
<p>LP-и могут внести один токен в заданный ценовой диапазон выше или ниже текущей цены: если рыночная цена входит в их заданный диапазон, они продают один актив за другой по плавной кривой, получая при этом комиссионные за своп.</p>
<p>Внесение средств в узкий диапазон напоминает традиционный лимитный ордер. Возможно положить ликвидность в определенный диапазон цен. Если цена например DAI в пуле DAI/USDC вырастет до определенной стоимости, то все DAI преобразуются в USDC, но если вдруг цена вернутся к исходному диапазону, но вся ликвидность будет автоматически преобразована обратно в ETH.</p>
<p><img src="https://images.ctfassets.net/oc3ca6rftwdu/2l33qlFlZ6f1KmeJOZ3rDp/55b6546fa088b619d70dcb3a5a54889d/range.png" alt="диапазон"></p>
<p>Лимитные ордера в более широких диапазонах могут оказаться особенно полезными для  <strong>фиксации прибыли, покупки на просадке</strong>  и  <strong>первичных событий эмиссии</strong>: в последнем случае эмитенты теперь могут депонировать ликвидность в один актив и указать точный диапазон цен, по которым они хотят продавать свои токены.</p>
<h3 id="капитальная-эффективность">Капитальная эффективность</h3>
<p>Концентрируя свою ликвидность, LP-и могут обеспечить  <strong>такую же глубину ликвидности, как v2 в заданных ценовых диапазонах, рискуя при этом гораздо меньшим капиталом.</strong>  Сохраненный капитал можно хранить отдельно, инвестировать в разные активы, депонировать в другие места в DeFi или использовать для увеличения экспозиции в заданном ценовом диапазоне, чтобы получать больше комиссионных за торговлю.</p>
<p>Пример:</p>
<p>Алиса и Боб хотят предоставить ликвидность в пуле ETH/DAI на Uniswap v3. У каждого из них по 1 миллион долларов США. Текущая цена ETH составляет 1500 DAI.</p>
<p>Алиса решает развернуть свой капитал по всему ценовому диапазону (как она бы сделала это в Uniswap v2). Она вносит 500 000 DAI и 333,33 ETH (что составляет в общей сложности 1 миллион долларов США).</p>
<p>Боб, наоборот, создает сконцентрированную позицию, внося деньги только в ценовой диапазон от 1000 до 2250. Он вносит 91 751 DAI и 61,17 ETH, что составляет в общей сложности около 183 500 долларов США. Он оставляет себе оставшиеся 816 500 долларов США, инвестируя их по своему усмотрению.</p>
<p>Хотя Алиса вложила в 5,44 раза больше капитала, чем Боб,  они получают одинаковую сумму комиссионных  , пока цена ETH/DAI остается в диапазоне от 1000 до 2250.</p>
<p><img src="https://images.ctfassets.net/oc3ca6rftwdu/pgajcrSvF51NZo6WQ7QMT/aa4dc1497cab699f5b5747e69160d9c5/example_1.png" alt="пример 1"></p>
<p>Позиция Боба также действует как своего рода стоп-лосс для его ликвидности. Ликвидность как Алисы, так и Боба будет полностью выражена в ETH, если цена ETH упадет до 0 долларов США. Однако Боб потеряет всего 159 000 долларов США, в то время как Алиса потеряет 1 миллион долларов США. Боб может использовать свои дополнительные 816 500 долларов США для хеджирования от снижения стоимости или инвестирования в любую другую мыслимую стратегию.</p>
<p><img src="https://images.ctfassets.net/oc3ca6rftwdu/7fJVwfL5ZEqwsfiAH6JvCV/74dcdb9c8d2500547e7bd1df272a14da/example_2.png" alt="пример 2"></p>
<p>Вместо того, чтобы обеспечивать эквивалентную глубину ликвидности, как LP-и v2 с меньшим капиталом, LP-и v3 могут выбрать  <strong>большую глубину с тем же количеством капитала</strong>  , что и их коллеги из v2. Это требует  <strong>принятия на себя большего ценового риска</strong>  («непостоянные потери»), одновременно поддерживая большие объемы торговли и получая более высокие комиссионные.</p>
<p>LP-и в более стабильных пулах, вероятно, будут предоставлять ликвидность в особенно узких диапазонах. Максимальный математический прирост капитальной эффективности достигнет максимума в 4000 раз для LP-ов, предоставляющих ликвидность в пределах одного ценового диапазона 0,10%. Фабрика пулов v3 технически способна поддерживать диапазоны с гранулярностью до 0,02%, что соответствует максимальному приросту капитальной эффективности в 20 000 раз по сравнению с v2. Однако более гранулированные пулы могут увеличить стоимость газа для свопа и могут быть более полезны на уровне 2.</p>
<h3 id="активная-ликвидность">Активная ликвидность</h3>
<p>Если рыночные цены выходят за пределы заданного LP-ом ценового диапазона, их ликвидность фактически удаляется из пула и больше не приносит прибыль. В этом состоянии ликвидность LP состоит полностью из менее ценного из двух активов, пока рыночная цена не вернется в их заданный ценовой диапазон или пока они не решат обновить свой диапазон с учетом текущих цен.</p>
<p>Менять свои позиции можно без полного вывода ликвидности, что отличает v3 от v2.</p>
<p>В v3 теоретически возможно, что в заданном ценовом диапазоне не будет ликвидности. Однако ожидаем, что рациональные LP-и будут постоянно обновлять свои ценовые диапазоны, чтобы охватывать текущую рыночную цену.</p>
<h3 id="гибкие-комиссии">Гибкие комиссии</h3>
<p>Uniswap v3 предлагает LP три отдельных уровня комиссионных за пару - 0,05%, 0,30% и 1,00%. Это множество вариантов гарантирует, что LP-и будут подстраивать свои маржи в соответствии с ожидаемой волатильностью пары: LP-и берут на себя больше риска в некоррелированных парах, таких как ETH/DAI, и, наоборот, принимают на себя минимальный риск в коррелированных парах, таких как USDC/DAI.</p>
<p>Хотя отдельные уровни комиссионных могут привести к некоторой фрагментации ликвидности,  считаем, что большинство пар будет калиброваться к очевидному уровню комиссионных, который затем будет служить каноническим рынком. Пары однородных активов собираются вокруг уровня комиссионных 0,05%, а пары, такие как ETH/DAI, используют 0,30%, в то время как экзотические активы имебт комиссии в 1,00%. Uniswap может добавлять дополнительные уровни комиссий по мере необходимости.</p>
<p>Кроме того, комиссионные за торговлю больше не переинвестируются автоматически в пул от имени LP-ов.</p>
<h3 id="расширенные-оракулы">Расширенные оракулы</h3>
<p>Uniswap v2 представил оракулы средневзвешенных по времени цен (TWAP). Эти оракулы служат критически важной частью инфраструктуры DeFi.</p>
<p>Оракулы V2 работают, сохраняя кумулятивные суммы цен пары Uniswap на секундной основе. Эти суммы цен можно проверить один раз в начале периода и один раз в конце, чтобы рассчитать точную средневзвешенную по времени цену (TWAP) за этот период.</p>
<p>Uniswap v3 предлагает значительные улучшения оракула TWAP, что позволяет рассчитать любую недавнюю средневзвешенную по времени цену (TWAP) за последние ~ 9 дней в одном вызове в цепочке. Это достигается за счет хранения массива кумулятивных сумм, а не только одной.</p>
<p><img src="https://images.ctfassets.net/oc3ca6rftwdu/645gRZmrsruhM4dXb2obKR/581ef8cb9406de64f2acd27145f1e778/oracles.png" alt="оракулы"></p>
<p>Этот массив исторических накопителей цен делает намного проще и дешевле создавать более продвинутые оракулы, которые включают простые скользящие средние (SMA), экспоненциальные скользящие средние (EMA), фильтрацию выбросов и многое другое.</p>
<p>Несмотря на это стоимость газа и стоимость расчета разительно ниже чем в Uniswap v2.</p>
<h3 id="nft-lp-токены">NFT LP токены</h3>
<p>Как побочный продукт индивидуальных ценовых кривых для каждого LP, позиции ликвидности больше не представлены в виде токенов ERC20.</p>
<p>Вместо этого позиции LP представлены в виде NFT токенов. Однако общие позиции могут быть взаимозаменяемыми (ERC20) с помощью периферийных контрактов или через другие партнерские протоколы.</p>
<p>Со временем ожидаем, что все более сложные стратегии будут токенизированы, что позволит LP-ам участвовать в них, сохраняя пассивный пользовательский опыт. Это может включать в себя многопозиции, автоматическую перебалансировку для концентрации вокруг рыночной цены, переинвестирование комиссионных, кредитование и многое другое.</p>
<h2 id="формулы-ценообразования">Формулы ценообразования:</h2>
<p>Uniswap v2 цены определяются классической формулой постоянного произведения <code>x * y = k</code>, где x и y — количество двух токенов в пуле, а k — постоянная. Эта формула предполагает, что ликвидность распределяется равномерно по всей ценовой кривой.</p>
<p>В Uniswap v3 эта модель была улучшена для учета концентрированной ликвидности, что позволяет LP (поставщикам ликвидности) выбирать конкретные ценовые диапазоны для предоставления ликвидности. В результате, формула была модифицирована для поддержки этой функциональности.</p>
<h3 id="основные-изменения-в-формуле-ценообразования-uniswap-v3">Основные изменения в формуле ценообразования Uniswap v3</h3>
<p>В Uniswap v3 формула постоянного произведения была модифицирована для учета концентрированной ликвидности, что позволяет LP (поставщикам ликвидности) выбирать конкретные ценовые диапазоны для предоставления ликвидности.</p>
<h3 id="формулы-в-uniswap-v3">Формулы в Uniswap v3</h3>
<h4 id="диапазонная-ликвидность">Диапазонная ликвидность:</h4>
<p>Uniswap v3 позволяет LP предоставлять ликвидность только в определенных ценовых диапазонах. Это требует изменения способа расчета ликвидности и цены.</p>
<p>Формула постоянного произведения в Uniswap v3 теперь работает с учетом определенного ценового диапазона. Она может быть представлена как:</p>
<p><code>L = sqrt(x * y)</code></p>
<p>где L — это обобщенная ликвидность (линейная ликвидность в диапазоне).</p>
<h4 id="учет-активной-ликвидности">Учет активной ликвидности</h4>
<p>В Uniswap v3 каждая ценовая пара может иметь несколько диапазонов ликвидности, предоставленных разными LP. Формула ценообразования должна учитывать активную ликвидность (ту, которая находится в текущем ценовом диапазоне).</p>
<p>При выполнении свопа в Uniswap v3 цена изменяется в пределах диапазона до тех пор, пока не достигнет границ этого диапазона. Как только цена выходит за границы одного диапазона, активируется следующий диапазон ликвидности.</p>
<h4 id="формула-расчета-цены">Формула расчета цены:</h4>
<p>Цена токена рассчитывается с использованием текущей ликвидности L и текущей цены P:</p>
<p><code>P_new = P_old * (1 + (Δx / L))^2</code></p>
<p>где Δx — количество токенов, добавленных в пул, P_old и P_new — старая и новая цена соответственно.</p>
<h4 id="пример-расчета">Пример расчета</h4>
<p>Предположим, у нас есть пара ETH/USDC. LP решили предоставить ликвидность в диапазоне цен от $2000 до $3000 за ETH. Формула будет учитывать только эту ликвидность при расчете цены в пределах этого диапазона. Если текущая цена ETH находится в пределах $2000-$3000, ликвидность будет активной, и сделки будут происходить в этом диапазоне.</p>
<p>Когда цена выходит за пределы $3000, активируется следующая часть ликвидности, если она существует. Это позволяет более точно управлять ликвидностью и использовать капитал эффективнее.</p>
<h3 id="имперманентные-потери">Имперманентные потери:</h3>
<p>Имперманентные потери возникают, когда цена токена меняется по отношению к цене на момент добавления в пул ликвидности. Это явление описывает потенциальную убыток LP, который может возникнуть, если цена активов сильно колеблется. В Uniswap v3, благодаря концентрированной ликвидности, LP могут снизить влияние имперманентных потерь, выбирая более узкие ценовые диапазоны, благодаря лимитным ордерам и управляя своими позициями более активно.</p>
<h3 id="преимущества-и-недостатки">Преимущества и недостатки</h3>
<p><strong>Преимущества:</strong></p>
<ul>
<li><strong>Повышенная эффективность капитала:</strong> Концентрированная ликвидность позволяет LP зарабатывать больше комиссионных на меньших инвестициях.</li>
<li><strong>Гибкость:</strong> LP могут выбирать ценовые диапазоны, менять свои позиции и адаптироваться к рыночным условиям.</li>
<li><strong>Разнообразие комиссионных уровней:</strong> Возможность выбора уровня комиссий в зависимости от пары токенов и рыночных условий.</li>
</ul>
<p><strong>Недостатки:</strong></p>
<ul>
<li><strong>Более сложная механика:</strong> Uniswap v3 требует большего понимания и активного управления по сравнению с v2.</li>
<li><strong>Риск имперманентных потерь:</strong> LP все равно подвержены рискам, связанным с изменением цен токенов.</li>
<li><strong>Необходимость активного управления:</strong> LP должны активно управлять своими позициями для максимизации доходов и минимизации рисков.</li>
</ul>
<h3 id="заключение">Заключение</h3>
<p>Uniswap v3 представляет собой значительное улучшение по сравнению с предыдущими версиями, предлагая более эффективное использование капитала и гибкость для поставщиков ликвидности. Хотя это требует большего понимания и управления, потенциальные выгоды для трейдеров и LP делают Uniswap v3 важным инструментом в арсенале любой трейдинговой компании. Применение инновационных технологий, таких как концентрированная ликвидность и NFT, позволяет Uniswap v3 оставаться лидером среди децентрализованных бирж и предоставляет пользователям новые возможности для торговли и заработка в мире DeFi.</p>

